# tomcat多线程处理及ThreadLocal使用注意

tomcat默认使用线程池来管理线程，即当收到一个请求时，如果线程池存在空闲线程，则会从中取出一个空闲线程来处理该请求。当一个线程在处理请求时，其他请求就不会被分配至该线程。

例如有a,b,c三个空闲线程：
1、当request1到来时，分配a线程来处理
2、同时有request2到来，此时a线程在处理中，因此只有bc两个空闲线程，则会从中选一个处理request2。
3、request1处理完成，request3来了，则就可能分配给空闲线程a来处理。

问题来了，如果项目中使用了ThreadLocal，则在步骤1中会存入a线程对应的数据，步骤2中会存入b线程对应的数据，二者互不干扰。当到步骤3时，由于复用了线程a，因此request3这个请求处理过程中，可以直接通过ThreadLocal取到步骤1中放入的数据。

因此，在写代码时，注意在请求处理结束之前，把ThreadLocal中存入的数据清空，防止后续线程复用时造成干扰。

https://blog.csdn.net/qq_37221991/article/details/93922136

